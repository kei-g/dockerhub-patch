var C=Object.create;var a=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var g=o=>a(o,"__esModule",{value:!0});var b=(o,e)=>{for(var t in e)a(o,t,{get:e[t],enumerable:!0})},h=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of T(e))!x.call(o,r)&&(t||r!=="default")&&a(o,r,{get:()=>e[r],enumerable:!(n=P(e,r))||n.enumerable});return o},w=(o,e)=>h(g(a(o!=null?C(y(o)):{},"default",!e&&o&&o.__esModule?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o),E=(o=>(e,t)=>o&&o.get(e)||(t=h(g({}),e,1),o&&o.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var R={};b(R,{CookieBaker:()=>k,communicateAsync:()=>u,dockerHubAsync:()=>p,loginAsync:()=>A,setDescriptionAsync:()=>H,toCookie:()=>d});var l=w(require("https")),v=(o,e)=>{var s,f;let t=o.payload&&JSON.stringify(o.payload),n={"Content-length":(s=t==null?void 0:t.length)!=null?s:0};o.payload&&(n["Content-type"]="application/json"),o.token&&(n.Authorization=`Bearer ${o.token}`);let r={headers:n,method:o.method||(o.payload?"POST":"GET")};o.agent&&(r.agent=o.agent);let i=l.request(o.url,r,m=>D(m,e));(f=o.baker)==null||f.bake(i),i.on("error",m=>e(m,void 0)),t&&i.write(t),i.end()},u=o=>new Promise((e,t)=>v(o,(n,r)=>n?t(n):e(r))),D=(o,e)=>{let t={};o.on("data",n=>t.data=t.data?Buffer.concat([t.data,n]):n),o.on("end",()=>t.data?e(void 0,JSON.parse(t.data.toString())):e(new Error("No data"),void 0)),o.on("error",n=>e(n,void 0))};var d=o=>{let e={common:{},fields:{},toString:()=>{let t=0,n=new Array(e.fields.length);for(let r in e.fields)n[t++]=`${r}=${e.fields[r]}`;return n.join("; ").trim()}};for(let t of o.split(";")){let n=t.split("="),r=n[0].trim();switch(r){case"Domain":case"Path":e.common[r]=n[1];break;case"Expires":e.common.Expires=new Date(n[1]);break;case"HttpOnly":case"Secure":e.common[r]=!0;break;default:e.fields[r]=n.slice(1).join("=");break}}return e};var c=class{constructor(){this.cookies={}}static get default(){return c.theOne}bake(e){var n,r,i;let t=(i=(r=(n=this.get(e.host))==null?void 0:n.map(s=>s.toString()))==null?void 0:r.join("; "))==null?void 0:i.trim();return(t==null?void 0:t.length)&&e.setHeader("Cookie",t),e.on("response",s=>{"set-cookie"in s.headers&&(this.cookies[e.host]=s.headers["set-cookie"].map(d))}),e}get(e){if(e in this.cookies){let t=Date.now(),n=this.cookies[e].filter(r=>t<r.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},k=c;k.theOne=new c;var p=(o,e)=>{let t=e;return t.url=`https://hub.docker.com/v2/${o}`,u(t)},A=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),p("users/login",e)},H=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),p(`repositories/${o.repo}`,e)};module.exports=E(R);0&&(module.exports={CookieBaker,communicateAsync,dockerHubAsync,loginAsync,setDescriptionAsync,toCookie});
