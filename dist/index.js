"use strict";var g=Object.create;var c=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var y=(o,e)=>{for(var t in e)c(o,t,{get:e[t],enumerable:!0})},h=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of x(e))!T.call(o,i)&&i!==t&&c(o,i,{get:()=>e[i],enumerable:!(n=C(e,i))||n.enumerable});return o};var P=(o,e,t)=>(t=o!=null?g(b(o)):{},h(e||!o||!o.__esModule?c(t,"default",{value:o,enumerable:!0}):t,o)),v=o=>h(c({},"__esModule",{value:!0}),o);var A={};y(A,{CookieBaker:()=>a,communicateAsync:()=>d,dockerHubAsync:()=>k,loginAsync:()=>D,setDescriptionAsync:()=>E,toCookie:()=>f});module.exports=v(A);var w=P(require("https")),H=(o,e)=>{var s,p,l;let t=o.payload&&JSON.stringify(o.payload),n={"Content-length":(s=t==null?void 0:t.length)!=null?s:0};o.payload&&(n["Content-type"]="application/json"),o.token&&(n.Authorization=`Bearer ${o.token}`);let i={headers:n,method:o.method||(o.payload?"POST":"GET")};o.agent&&(i.agent=o.agent);let r=((p=o.http)!=null?p:w).request(o.url,i,u=>R(u,e));(l=o.baker)==null||l.bake(r),r.on("error",u=>e(u,void 0)),t&&r.write(t),r.end()},d=o=>new Promise((e,t)=>H(o,(n,i)=>n?t(n):e(i))),R=(o,e)=>{let t={};o.on("data",n=>t.data=t.data?Buffer.concat([t.data,n]):n),o.on("end",()=>t.data?e(void 0,JSON.parse(t.data.toString())):e(new Error("No data"),void 0)),o.on("error",n=>e(n,void 0))};var f=o=>{let e={common:{},fields:{},toString:()=>{let t=0,n=new Array(e.fields.length);for(let i in e.fields)n[t++]=`${i}=${e.fields[i]}`;return n.join("; ").trim()}};for(let t of o.split(";")){let n=t.split("="),i=n[0].trim();switch(i){case"Domain":case"Path":e.common[i]=n[1];break;case"Expires":e.common.Expires=new Date(n[1]);break;case"HttpOnly":case"Secure":e.common[i]=!0;break;default:e.fields[i]=n.slice(1).join("=");break}}return e};var m=class{constructor(){this.cookies={}}static get default(){return m.theOne}bake(e){var n,i,r;let t=(r=(i=(n=this.get(e.host))==null?void 0:n.map(s=>s.toString()))==null?void 0:i.join("; "))==null?void 0:r.trim();return t!=null&&t.length&&e.setHeader("Cookie",t),e.on("response",s=>{"set-cookie"in s.headers&&(this.cookies[e.host]=s.headers["set-cookie"].map(f))}),e}get(e){if(e in this.cookies){let t=Date.now(),n=this.cookies[e].filter(i=>t<i.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},a=m;a.theOne=new m;var k=(o,e)=>{let t=e;return t.url=`https://hub.docker.com/v2/${o}`,d(t)},D=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),k("users/login",e)},E=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),k(`repositories/${o.repo}`,e)};0&&(module.exports={CookieBaker,communicateAsync,dockerHubAsync,loginAsync,setDescriptionAsync,toCookie});
