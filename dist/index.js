import*as y from"https";var m=(t,e)=>o=>e(o,t),T=(t,e)=>{let o=t.payload&&JSON.stringify(t.payload),n={"Content-length":o?.length??0};p(t.payload,n,"Content-type","application/json"),p(t.token,n,"Authorization",`Bearer: ${t.token}`);let i=["GET","POST"],c={headers:n,method:t.method||i[+t.payload]};p(t.agent,c,"agent",t.agent);let s=(t.http??y).request(t.url,c,m(e,P));t.baker?.bake(s),s.on("error",m(void 0,e)),o&&s.write(o),s.end()},f=t=>new Promise((e,o)=>T(t,v(e,o))),v=(t,e)=>(o,n)=>o?e(o):t(n),P=(t,e)=>{let o={};t.on("data",n=>o.data=o.data?Buffer.concat([o.data,n]):n),t.on("end",()=>o.data?e(void 0,JSON.parse(o.data.toString())):e(new Error("No data"),void 0)),t.on("error",m(void 0,e))},p=(t,e,o,n)=>{t&&(e[o]=n)};var d=class{visit(e,o){for(let n of o)if(this.handle(e,n))break}},r=class extends d{constructor(o,n){super();this.preferredMethod=o;this.preferredKey=n}handle(o,n){let i=n.key===this.preferredKey;return i&&this.preferredMethod.bind(o)(n.value),i}},l=class extends d{handle(e,o){return e.accept(o),!1}},u=class{constructor(){this.fields={};this.common={Domain:void 0,Expires:void 0,Path:void 0}}accept(e){this.fields[e.key]=e.value}acceptDomain(e){this.common.Domain=e}acceptExpires(e){this.common.Expires=new Date(e)}acceptHttpOnly(e){this.common.HttpOnly=!0}acceptPath(e){this.common.Path=e}acceptSecure(e){this.common.Secure=!0}toString(){let e=0,o=new Array(this.fields.length);for(let n in this.fields)o[e++]=`${n}=${this.fields[n]}`;return o.join("; ").trim()}},a=new u,h=t=>{let e=new u,o=new Array;for(let n of t.split(";")){let i=n.split("="),c=i[0].trim(),s=i.slice(1).join("=");o.push({key:c,value:s})}for(let n of C)n.visit(e,o);return e},C=[new r(a.acceptDomain,"Domain"),new r(a.acceptExpires,"Expires"),new r(a.acceptHttpOnly,"HttpOnly"),new r(a.acceptPath,"Path"),new r(a.acceptSecure,"Secure"),new l];var k=class t{constructor(){this.cookies={}}static{this.theOne=new t}static get default(){return t.theOne}bake(e){let o=this.get(e.host)?.map(b)?.join("; ")?.trim();return o?.length&&e.setHeader("Cookie",o),e.on("response",n=>{"set-cookie"in n.headers&&(this.cookies[e.host]=n.headers["set-cookie"].map(h))}),e}get(e){if(e in this.cookies){let o=Date.now(),n=this.cookies[e].filter(i=>o<i.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},b=t=>t.toString();var g=(t,e)=>{let o=e;return o.url=`https://hub.docker.com/v2/${t}`,f(o)},V=t=>{let e={method:"POST",payload:{password:t.password,username:t.username}};return t.agent&&(e.agent=t.agent),t.baker&&(e.baker=t.baker),t.http&&(e.http=t.http),g("users/login",e)},L=t=>{let e={method:"PATCH",payload:{description:t.description,full_description:t.overview},token:t.token};return t.agent&&(e.agent=t.agent),t.baker&&(e.baker=t.baker),t.http&&(e.http=t.http),g(`repositories/${t.repo}`,e)};export{k as CookieBaker,f as communicateAsync,g as dockerHubAsync,V as loginAsync,L as setDescriptionAsync,h as toCookie};
