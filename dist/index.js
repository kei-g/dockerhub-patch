import*as h from"https";var g=(o,e)=>{var s,u,p;let t=o.payload&&JSON.stringify(o.payload),n={"Content-length":(s=t==null?void 0:t.length)!=null?s:0};o.payload&&(n["Content-type"]="application/json"),o.token&&(n.Authorization=`Bearer ${o.token}`);let i={headers:n,method:o.method||(o.payload?"POST":"GET")};o.agent&&(i.agent=o.agent);let r=((u=o.http)!=null?u:h).request(o.url,i,c=>l(c,e));(p=o.baker)==null||p.bake(r),r.on("error",c=>e(c,void 0)),t&&r.write(t),r.end()},d=o=>new Promise((e,t)=>g(o,(n,i)=>n?t(n):e(i))),l=(o,e)=>{let t={};o.on("data",n=>t.data=t.data?Buffer.concat([t.data,n]):n),o.on("end",()=>t.data?e(void 0,JSON.parse(t.data.toString())):e(new Error("No data"),void 0)),o.on("error",n=>e(n,void 0))};var k=o=>{let e={common:{},fields:{},toString:()=>{let t=0,n=new Array(e.fields.length);for(let i in e.fields)n[t++]=`${i}=${e.fields[i]}`;return n.join("; ").trim()}};for(let t of o.split(";")){let n=t.split("="),i=n[0].trim();switch(i){case"Domain":case"Path":e.common[i]=n[1];break;case"Expires":e.common.Expires=new Date(n[1]);break;case"HttpOnly":case"Secure":e.common[i]=!0;break;default:e.fields[i]=n.slice(1).join("=");break}}return e};var a=class{constructor(){this.cookies={}}static get default(){return a.theOne}bake(e){var n,i,r;let t=(r=(i=(n=this.get(e.host))==null?void 0:n.map(s=>s.toString()))==null?void 0:i.join("; "))==null?void 0:r.trim();return t!=null&&t.length&&e.setHeader("Cookie",t),e.on("response",s=>{"set-cookie"in s.headers&&(this.cookies[e.host]=s.headers["set-cookie"].map(k))}),e}get(e){if(e in this.cookies){let t=Date.now(),n=this.cookies[e].filter(i=>t<i.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},m=a;m.theOne=new a;var f=(o,e)=>{let t=e;return t.url=`https://hub.docker.com/v2/${o}`,d(t)},R=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),f("users/login",e)},D=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),f(`repositories/${o.repo}`,e)};export{m as CookieBaker,d as communicateAsync,f as dockerHubAsync,R as loginAsync,D as setDescriptionAsync,k as toCookie};
