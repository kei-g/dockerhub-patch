"use strict";var l=Object.create;var a=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var x=(o,e)=>{for(var t in e)a(o,t,{get:e[t],enumerable:!0})},g=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of P(e))!y.call(o,r)&&r!==t&&a(o,r,{get:()=>e[r],enumerable:!(n=C(e,r))||n.enumerable});return o};var b=(o,e,t)=>(t=o!=null?l(T(o)):{},g(e||!o||!o.__esModule?a(t,"default",{value:o,enumerable:!0}):t,o)),w=o=>g(a({},"__esModule",{value:!0}),o);var H={};x(H,{CookieBaker:()=>c,communicateAsync:()=>d,dockerHubAsync:()=>p,loginAsync:()=>D,setDescriptionAsync:()=>A,toCookie:()=>k});module.exports=w(H);var h=b(require("https")),E=(o,e)=>{var s,f;let t=o.payload&&JSON.stringify(o.payload),n={"Content-length":(s=t==null?void 0:t.length)!=null?s:0};o.payload&&(n["Content-type"]="application/json"),o.token&&(n.Authorization=`Bearer ${o.token}`);let r={headers:n,method:o.method||(o.payload?"POST":"GET")};o.agent&&(r.agent=o.agent);let i=h.request(o.url,r,u=>v(u,e));(f=o.baker)==null||f.bake(i),i.on("error",u=>e(u,void 0)),t&&i.write(t),i.end()},d=o=>new Promise((e,t)=>E(o,(n,r)=>n?t(n):e(r))),v=(o,e)=>{let t={};o.on("data",n=>t.data=t.data?Buffer.concat([t.data,n]):n),o.on("end",()=>t.data?e(void 0,JSON.parse(t.data.toString())):e(new Error("No data"),void 0)),o.on("error",n=>e(n,void 0))};var k=o=>{let e={common:{},fields:{},toString:()=>{let t=0,n=new Array(e.fields.length);for(let r in e.fields)n[t++]=`${r}=${e.fields[r]}`;return n.join("; ").trim()}};for(let t of o.split(";")){let n=t.split("="),r=n[0].trim();switch(r){case"Domain":case"Path":e.common[r]=n[1];break;case"Expires":e.common.Expires=new Date(n[1]);break;case"HttpOnly":case"Secure":e.common[r]=!0;break;default:e.fields[r]=n.slice(1).join("=");break}}return e};var m=class{constructor(){this.cookies={}}static get default(){return m.theOne}bake(e){var n,r,i;let t=(i=(r=(n=this.get(e.host))==null?void 0:n.map(s=>s.toString()))==null?void 0:r.join("; "))==null?void 0:i.trim();return t!=null&&t.length&&e.setHeader("Cookie",t),e.on("response",s=>{"set-cookie"in s.headers&&(this.cookies[e.host]=s.headers["set-cookie"].map(k))}),e}get(e){if(e in this.cookies){let t=Date.now(),n=this.cookies[e].filter(r=>t<r.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},c=m;c.theOne=new m;var p=(o,e)=>{let t=e;return t.url=`https://hub.docker.com/v2/${o}`,d(t)},D=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),p("users/login",e)},A=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),p(`repositories/${o.repo}`,e)};0&&(module.exports={CookieBaker,communicateAsync,dockerHubAsync,loginAsync,setDescriptionAsync,toCookie});
