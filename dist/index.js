import*as d from"https";var k=(o,e)=>{let n=o.payload&&JSON.stringify(o.payload),t={"Content-length":n?.length??0};o.payload&&(t["Content-type"]="application/json"),o.token&&(t.Authorization=`Bearer ${o.token}`);let i={headers:t,method:o.method||(o.payload?"POST":"GET")};o.agent&&(i.agent=o.agent);let r=(o.http??d).request(o.url,i,s=>f(s,e));o.baker?.bake(r),r.on("error",s=>e(s,void 0)),n&&r.write(n),r.end()},c=o=>new Promise((e,n)=>k(o,(t,i)=>t?n(t):e(i))),f=(o,e)=>{let n={};o.on("data",t=>n.data=n.data?Buffer.concat([n.data,t]):t),o.on("end",()=>n.data?e(void 0,JSON.parse(n.data.toString())):e(new Error("No data"),void 0)),o.on("error",t=>e(t,void 0))};var a=o=>{let e={common:{},fields:{},toString:()=>{let n=0,t=new Array(e.fields.length);for(let i in e.fields)t[n++]=`${i}=${e.fields[i]}`;return t.join("; ").trim()}};for(let n of o.split(";")){let t=n.split("="),i=t[0].trim();switch(i){case"Domain":case"Path":e.common[i]=t[1];break;case"Expires":e.common.Expires=new Date(t[1]);break;case"HttpOnly":case"Secure":e.common[i]=!0;break;default:e.fields[i]=t.slice(1).join("=");break}}return e};var m=class o{constructor(){this.cookies={}}static{this.theOne=new o}static get default(){return o.theOne}bake(e){let n=this.get(e.host)?.map(t=>t.toString())?.join("; ")?.trim();return n?.length&&e.setHeader("Cookie",n),e.on("response",t=>{"set-cookie"in t.headers&&(this.cookies[e.host]=t.headers["set-cookie"].map(a))}),e}get(e){if(e in this.cookies){let n=Date.now(),t=this.cookies[e].filter(i=>n<i.common.Expires.getTime());if(t.length)return this.cookies[e]=t;delete this.cookies[e]}}};var u=(o,e)=>{let n=e;return n.url=`https://hub.docker.com/v2/${o}`,c(n)},v=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),u("users/login",e)},w=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),u(`repositories/${o.repo}`,e)};export{m as CookieBaker,c as communicateAsync,u as dockerHubAsync,v as loginAsync,w as setDescriptionAsync,a as toCookie};
