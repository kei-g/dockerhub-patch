var u=(t,e)=>o=>e(o,t),f=(t,e)=>(o,n)=>o?e(o):t(n),i=(t,e,o,n)=>{t&&(e[o]=n)};import*as v from"https";var x=(t,e)=>{let o=t.payload&&JSON.stringify(t.payload),n={"Content-length":o?.length??0};i(t.payload,n,"Content-type","application/json"),i(t.token,n,"Authorization",`Bearer: ${t.token}`);let r=["GET","POST"],a={headers:n,method:t.method||r[+t.payload]};i(t.agent,a,"agent",t.agent);let c=(t.http??v).request(t.url,a,u(e,P));t.baker?.bake(c),c.on("error",u(void 0,e)),o&&c.write(o),c.end()},h=t=>new Promise((e,o)=>x(t,f(e,o))),P=(t,e)=>{let o={};t.on("data",n=>o.data=o.data?Buffer.concat([o.data,n]):n),t.on("end",()=>o.data?e(void 0,JSON.parse(o.data.toString())):e(new Error("No data"),void 0)),t.on("error",u(void 0,e))};var m=class{visit(e,o){for(let n of o)if(this.handle(e,n))break}},s=class extends m{constructor(o,n){super();this.preferredMethod=o;this.preferredKey=n}handle(o,n){let r=n.key===this.preferredKey;return r&&this.preferredMethod.bind(o)(n.value),r}},l=class extends m{handle(e,o){return e.accept(o),!1}},p=class{constructor(){this.fields={};this.common={Domain:void 0,Expires:void 0,Path:void 0}}accept(e){this.fields[e.key]=e.value}acceptDomain(e){this.common.Domain=e}acceptExpires(e){this.common.Expires=new Date(e)}acceptHttpOnly(e){this.common.HttpOnly=!0}acceptPath(e){this.common.Path=e}acceptSecure(e){this.common.Secure=!0}toString(){let e=0,o=new Array(this.fields.length);for(let n in this.fields)o[e++]=`${n}=${this.fields[n]}`;return o.join("; ").trim()}},d=new p,k=t=>{let e=new p,o=new Array;for(let n of t.split(";")){let r=n.split("="),a=r[0].trim(),c=r.slice(1).join("=");o.push({key:a,value:c})}for(let n of b)n.visit(e,o);return e},b=[new s(d.acceptDomain,"Domain"),new s(d.acceptExpires,"Expires"),new s(d.acceptHttpOnly,"HttpOnly"),new s(d.acceptPath,"Path"),new s(d.acceptSecure,"Secure"),new l];var g=class t{constructor(){this.cookies={}}static{this.theOne=new t}static get default(){return t.theOne}bake(e){let o=this.get(e.host)?.map(T)?.join("; ")?.trim();return o?.length&&e.setHeader("Cookie",o),e.on("response",n=>{"set-cookie"in n.headers&&(this.cookies[e.host]=n.headers["set-cookie"].map(k))}),e}get(e){if(e in this.cookies){let o=Date.now(),n=this.cookies[e].filter(r=>o<r.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},T=t=>t.toString();var y=(t,e)=>{let o=e;return o.url=`https://hub.docker.com/v2/${t}`,h(o)},U=t=>{let e={method:"POST",payload:{password:t.password,username:t.username}};return i(t.agent,e,"agent",t.agent),i(t.baker,e,"baker",t.baker),i(t.http,e,"http",t.http),y("users/login",e)},j=t=>{let e={method:"PATCH",payload:{description:t.description,full_description:t.overview},token:t.token};return i(t.agent,e,"agent",t.agent),i(t.baker,e,"baker",t.baker),i(t.http,e,"http",t.http),y(`repositories/${t.repo}`,e)};export{g as CookieBaker,h as communicateAsync,y as dockerHubAsync,U as loginAsync,j as setDescriptionAsync,k as toCookie};
