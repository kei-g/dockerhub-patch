"use strict";var l=Object.create;var a=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var y=(o,e)=>{for(var t in e)a(o,t,{get:e[t],enumerable:!0})},g=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of P(e))!x.call(o,i)&&i!==t&&a(o,i,{get:()=>e[i],enumerable:!(n=C(e,i))||n.enumerable});return o};var b=(o,e,t)=>(t=o!=null?l(T(o)):{},g(e||!o||!o.__esModule?a(t,"default",{value:o,enumerable:!0}):t,o)),H=o=>g(a({},"__esModule",{value:!0}),o);var A={};y(A,{CookieBaker:()=>c,communicateAsync:()=>p,dockerHubAsync:()=>k,loginAsync:()=>R,setDescriptionAsync:()=>D,toCookie:()=>d});module.exports=H(A);var w=b(require("https")),E=(o,e)=>{var s,f,h;let t=o.payload&&JSON.stringify(o.payload),n={"Content-length":(s=t==null?void 0:t.length)!=null?s:0};o.payload&&(n["Content-type"]="application/json"),o.token&&(n.Authorization=`Bearer ${o.token}`);let i={headers:n,method:o.method||(o.payload?"POST":"GET")};o.agent&&(i.agent=o.agent);let r=((f=o.http)!=null?f:w).request(o.url,i,u=>v(u,e));(h=o.baker)==null||h.bake(r),r.on("error",u=>e(u,void 0)),t&&r.write(t),r.end()},p=o=>new Promise((e,t)=>E(o,(n,i)=>n?t(n):e(i))),v=(o,e)=>{let t={};o.on("data",n=>t.data=t.data?Buffer.concat([t.data,n]):n),o.on("end",()=>t.data?e(void 0,JSON.parse(t.data.toString())):e(new Error("No data"),void 0)),o.on("error",n=>e(n,void 0))};var d=o=>{let e={common:{},fields:{},toString:()=>{let t=0,n=new Array(e.fields.length);for(let i in e.fields)n[t++]=`${i}=${e.fields[i]}`;return n.join("; ").trim()}};for(let t of o.split(";")){let n=t.split("="),i=n[0].trim();switch(i){case"Domain":case"Path":e.common[i]=n[1];break;case"Expires":e.common.Expires=new Date(n[1]);break;case"HttpOnly":case"Secure":e.common[i]=!0;break;default:e.fields[i]=n.slice(1).join("=");break}}return e};var m=class{constructor(){this.cookies={}}static get default(){return m.theOne}bake(e){var n,i,r;let t=(r=(i=(n=this.get(e.host))==null?void 0:n.map(s=>s.toString()))==null?void 0:i.join("; "))==null?void 0:r.trim();return t!=null&&t.length&&e.setHeader("Cookie",t),e.on("response",s=>{"set-cookie"in s.headers&&(this.cookies[e.host]=s.headers["set-cookie"].map(d))}),e}get(e){if(e in this.cookies){let t=Date.now(),n=this.cookies[e].filter(i=>t<i.common.Expires.getTime());if(n.length)return this.cookies[e]=n;delete this.cookies[e]}}},c=m;c.theOne=new m;var k=(o,e)=>{let t=e;return t.url=`https://hub.docker.com/v2/${o}`,p(t)},R=o=>{let e={method:"POST",payload:{password:o.password,username:o.username}};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),k("users/login",e)},D=o=>{let e={method:"PATCH",payload:{description:o.description,full_description:o.overview},token:o.token};return o.agent&&(e.agent=o.agent),o.baker&&(e.baker=o.baker),o.http&&(e.http=o.http),k(`repositories/${o.repo}`,e)};0&&(module.exports={CookieBaker,communicateAsync,dockerHubAsync,loginAsync,setDescriptionAsync,toCookie});
